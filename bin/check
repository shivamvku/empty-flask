#!/usr/bin/env bash

HOST_PORT=$1

function health-check {
  curl -sIXGET http://localhost:"${HOST_PORT}"/ | grep -q '200 OK'
}

echo -n "Checking connection to service"

count=0
until health-check; do

  if [ $count -ge 60 ]
  then
    echo -e "\nService unavailable: exit status code 1"
    exit 1
  fi

  count=$((count + 1))
  echo -n '.'
  sleep 1

done

echo -e "\nSUCCESS: service responded '200 OK'"
